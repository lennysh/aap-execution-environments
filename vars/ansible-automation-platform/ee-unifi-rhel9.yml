---
dest_registry_name: quay.io
rhel_version: rhel9
ansible_core_version: 2.17
ee_build_tag: 2.17 # defaults to latest
ee_registry_add_timestamp_tag: false # defaults to true
image_name: lshirley/ansible-automation-platform/ee-unifi-{{ rhel_version | trim }}
ee_base_image: registry.redhat.io/ansible-automation-platform/ee-minimal-{{ rhel_version | trim }}:{{ ansible_core_version }}
ee_base_sig_name: registry.redhat.io/ansible-automation-platform/ee-minimal-{{ rhel_version | trim }}:{{ ansible_core_version }}
ee_package_manager_path: /usr/bin/microdnf
# ee_python_interpreter:
#  package_system: "python310"
#  python_path: "/usr/bin/python3.11"
ee_build_files:
  - src: "{{ build_ee_dest_dir }}/ansible.cfg"
    dest: configs
  # - src: "{{ build_ee_dest_dir }}/epel-release-latest-9.noarch.rpm"
  #   dest: files
ee_bindep:
  # - python3.13 [platform:rpm]
  - python3.13-devel [platform:rpm]
  - pkg-config [platform:rpm]
  - systemd-devel [platform:rpm]
  - gcc [platform:rpm]
# ee_python:
#   - aiounifi==77
#   - aiohttp>=3.9.0
#   - PyYAML>=6.0
ee_collections:
  - name: https://github.com/lennysh/ansible-unifi-inventory.git  # aioue.unifi
    type: git
    version: convert-to-ansible-collection
ee_prepend_base:
#   - RUN microdnf upgrade -y
  # - ADD _build/files/epel-release-latest-9.noarch.rpm /etc/ansible/epel-release-latest-9.noarch.rpm
  # Many EPEL packages require the CodeReady Builder (CRB) repository
  # - RUN /usr/bin/crb enable
  # Install EPEL repository
  - RUN curl -o ./epel-release-latest.rpm https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm
  - RUN rpm -i ./epel-release-latest.rpm
  # Install Python 3.13
  - RUN microdnf install -y python3.13 python3.13-pip
  # Create needed symLinks for Python 3.13
  - RUN alternatives --install /usr/bin/python3 python3 /usr/bin/python3.13 1
  - RUN alternatives --install /usr/bin/pip3 pip3 /usr/bin/pip3.13 1
  - RUN alternatives --remove python3 /usr/bin/python3.11
  - RUN alternatives --remove pip3 /usr/bin/pip3.11
  # Remove Ansible
  - RUN pip3.11 uninstall ansible ansible-runner -y
  # Re-install Ansible 2.17
  - RUN pip3 install ansible~=10.0.1 ansible-runner==2.3.6
ee_prepend_galaxy:
  - ADD _build/configs/ansible.cfg /etc/ansible/ansible.cfg
# ee_prepend_builder:
#   -
# ee_prepend_final:
#   -
ee_append_final:
  - RUN microdnf reinstall tzdata -y
  - RUN rm -f /etc/ansible/ansible.cfg
  - RUN microdnf clean all
